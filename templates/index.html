{% extends "base.html" %}
{% load staticfiles %}
{% block title %} Welcome to {{ site.name }} | {{ site.name }} {% endblock %}


{% block content %}
{#{% include "includes/banner.html" %}#}
<section class="container">
    {% include "includes/section-best-rate.html" %}
    {% include "includes/now-in-cinema.html" %}
    
</section>
{% endblock %}



{% block scripts %}
<!-- JavaScript-->
<!-- jQuery 1.9.1--> 
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="js/external/jquery-1.10.1.min.js"><\/script>')</script>
<!-- Migrate --> 
<script src="{% static "js/external/jquery-migrate-1.2.1.min.js" %}"></script>
<!-- Bootstrap 3--> 
<script src="http://netdna.bootstrapcdn.com/bootstrap/3.0.2/js/bootstrap.min.js"></script>

<!-- jQuery REVOLUTION Slider -->
<script type="text/javascript" src="{% static "rs-plugin/js/jquery.themepunch.plugins.min.js" %}"></script>
<script type="text/javascript" src="{% static "rs-plugin/js/jquery.themepunch.revolution.min.js" %}"></script>

<!-- Mobile menu -->
<script src="{% static "js/jquery.mobile.menu.js" %}"></script>
<!-- Select -->
<script src="{% static "js/external/jquery.selectbox-0.2.min.js" %}"></script>
<!-- Stars rate -->
<script src="{% static "js/external/jquery.raty.js" %}"></script>

<!-- Form element -->
<script src="{% static "js/external/form-element.js" %}"></script>
<!-- Form validation -->
<script src="{% static "js/form.js" %}"></script>

<!-- Custom -->
<script src="{% static "js/custom.js" %}"></script>



<script type="text/javascript">
        $(document).ready(function() {
            $.fn.raty.defaults.path = "{{ STATIC_URL }}images/rate";
            $.fn.raty.defaults.size = 24;
            
            $.fn.raty.defaults.starOn = "star-on.png";
            $.fn.raty.defaults.starHalf = "star-half.png";
            $.fn.raty.defaults.half = true;
            $.fn.raty.defaults.single = false;
            
            $('.score').raty({
                half: false,
                score: function() {
                    return $(this).attr('data-score');
                },
                click: function(score, evt) {
                    var current_rating = 0;
                    if (score != null) {
                        current_rating = score;
                    }
                    movieId = $(this).attr('movieId');
                    $.ajax({
                        url: "{% url 'rating' %}",
                        type: "POST",
                        data: { 'rating': current_rating, 'movieId': movieId, 
                                'csrfmiddlewaretoken': '{{ csrf_token }}'},
                        statusCode: {
                            403: function(jqXHR, textStatus, errorThrown) {
                                // invalid rating was posted
                                console.log(errorThrown);
                            },
                            200: function(data, textStatus, jqXHR) {
                                obj = $.parseJSON(data);
                                $('.movieScoreId'+obj.movieId.toString()).text(obj.avg.toFixed(1));
                                $('.score#movieId'+obj.movieId).raty('set', {readOnly: false, score: obj.rating });
                                $('.score#movieId'+obj.movieId).raty('set', {readOnly: true });
                            }
                        }
                    });
                },
                cancel: false
            });
        });
    </script>

{% endblock%}